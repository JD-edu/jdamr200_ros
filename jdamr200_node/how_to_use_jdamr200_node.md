# jdAMR200_node ì‚¬ì „ ì„¤ì •, ì‹¤í–‰, ì†ŒìŠ¤ ì„¤ëª… 

## ðŸ”Œ 1. jdamr200 ìž„ë² ë””ë“œ ë³´ë“œ ì‹œë¦¬ì–¼ í¬íŠ¸ í™•ì¸ ë°©ë²•

### âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ ëª©ë¡ í™•ì¸

í„°ë¯¸ë„ì—ì„œ ì•„ëž˜ ëª…ë ¹ì–´ë¥¼ ìž…ë ¥í•˜ë©´ ì—°ê²°ëœ ì‹œë¦¬ì–¼ ë””ë°”ì´ìŠ¤ë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤:

```bash
$ ls /dev/tty*
```

### âœ… ìžì£¼ ì‚¬ìš©ë˜ëŠ” í¬íŠ¸ ì´ë¦„ ì˜ˆì‹œ

* Arduino: `/dev/ttyACM0` ë˜ëŠ” `/dev/ttyUSB0`
* ESP32: `/dev/ttyUSB0` ë˜ëŠ” `/dev/ttyUSB1`

ë³´ë“œë¥¼ USBë¡œ ì—°ê²°í•œ ì§í›„ ìƒˆë¡­ê²Œ ìƒê¸´ `/dev/tty*`ê°€ í•´ë‹¹ í¬íŠ¸ìž…ë‹ˆë‹¤.

---

## ðŸ” 2. ì‹œë¦¬ì–¼ í¬íŠ¸ ê¶Œí•œ ì„¤ì •

ì‹œë¦¬ì–¼ í¬íŠ¸ëŠ” ì¼ë°˜ ì‚¬ìš©ìžì—ê²Œ ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ê·¼ ê¶Œí•œì´ ì—†ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### âœ” ë°©ë²• 1: `chmod`ë¡œ ì§ì ‘ ê¶Œí•œ ë¶€ì—¬

```bash
$ sudo chmod 777 /dev/ttyACM0
```

> ìœ„ ëª…ë ¹ì€ í•´ë‹¹ í¬íŠ¸ì— ì½ê¸°/ì“°ê¸° ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. ë‹¤ë§Œ USBë¥¼ ìž¬ì—°ê²°í•˜ë©´ ì´ˆê¸°í™”ë˜ë¯€ë¡œ ë§¤ë²ˆ ì‹¤í–‰í•´ì•¼ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### âœ” ë°©ë²• 2: ì‚¬ìš©ìž ê·¸ë£¹ì— ì¶”ê°€ (ì¶”ì²œ)

```bash
$ sudo usermod -a -G dialout $USER
```

ê·¸ í›„ ë¡œê·¸ì•„ì›ƒ â†’ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë©´ `/dev/ttyACM0` ì ‘ê·¼ ê¶Œí•œì´ ìžë™ìœ¼ë¡œ ì£¼ì–´ì§‘ë‹ˆë‹¤.

---

## ðŸ§  jdamr200\_node.py ì½”ë“œ ì„¤ëª…

ì´ ë…¸ë“œëŠ” `Jdamr200`ì´ë¼ëŠ” í´ëž˜ìŠ¤(ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì— êµ¬í˜„ë¨)ë¥¼ í†µí•´ **ìž„ë² ë””ë“œ ë³´ë“œì™€ ì‹œë¦¬ì–¼ í†µì‹ **ì„ í•©ë‹ˆë‹¤. ì£¼ìš” ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

### ðŸ“¥ `/cmd_vel` êµ¬ë…

* **í‚¤ë³´ë“œ ì¡°ìž‘ ë˜ëŠ” ROS ì œì–´ ë…¸ë“œ**ì—ì„œ ë°œí–‰ëœ `/cmd_vel` ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
* ë©”ì‹œì§€ì˜ linear.x/y/z ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ë¡œë´‡ì˜ ë°©í–¥ê³¼ ì†ë„ë¥¼ ê²°ì •í•˜ì—¬, `Jdamr200.move_run_mode()`ë¥¼ í†µí•´ ë³´ë“œë¡œ ëª¨í„° ì œì–´ ëª…ë ¹ì„ ì „ì†¡í•©ë‹ˆë‹¤.

### ðŸ“¤ `/odom` í¼ë¸”ë¦¬ì‹œ

* ì¼ì • ì£¼ê¸°(0.05ì´ˆ)ë¡œ `self.robot.readSpeed()`ì™€ `update_odometry()`ë¥¼ í˜¸ì¶œí•´ ë¡œë´‡ì˜ ìœ„ì¹˜ë¥¼ ê³„ì‚°í•˜ê³ , ROS `Odometry` ë©”ì‹œì§€ë¡œ í¼ë¸”ë¦¬ì‹œí•©ë‹ˆë‹¤.

### ðŸ”‹ `/Voltage` í¼ë¸”ë¦¬ì‹œ

* 1ì´ˆë§ˆë‹¤ ìž„ì˜ì˜ ì „ì••ê°’(ì˜ˆ: 100)ì„ ë°œí–‰í•©ë‹ˆë‹¤. (ì‹¤ì œ ì „ì•• ì¸¡ì • ê¸°ëŠ¥ì€ í–¥í›„ êµ¬í˜„ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤)

---

## ðŸ ì‹¤í–‰ ë°©ë²• ìš”ì•½

```bash
# ì†ŒìŠ¤ì›Œí¬ìŠ¤íŽ˜ì´ìŠ¤ ë¡œë”©
source ~/jdamr200_ws/install/setup.bash

# jdamr200_node ì‹¤í–‰
ros2 run jdamr200_node jdamr200_node
```

---

ì´ ë…¸ë“œëŠ” í•˜ë“œì›¨ì–´ì— ì§ì ‘ ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” ì—­í• ì„ í•˜ë¯€ë¡œ, ì‹¤í–‰ ì „ì— ë°˜ë“œì‹œ:

1. ì‹œë¦¬ì–¼ í¬íŠ¸ í™•ì¸ (`ls /dev/tty*`)
2. ì‹œë¦¬ì–¼ ê¶Œí•œ ë¶€ì—¬ (`chmod` ë˜ëŠ” `dialout` ê·¸ë£¹ ì¶”ê°€)
3. `Jdamr200` í´ëž˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸(`/dev/ttyACM0` ë“±)ê°€ ì •í™•ížˆ ì„¤ì •ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸

ìœ„ í•­ëª©ì„ ì ê²€í•´ ì£¼ì„¸ìš”.

## 3 ë…¸ë“œ ì†ŒìŠ¤ì½”ë“œ ì„¤ëª… 

ì¢‹ìŠµë‹ˆë‹¤. ì•„ëž˜ëŠ” `jdamr200_node`ì˜ í•µì‹¬ Python ì†ŒìŠ¤ì½”ë“œ(`jdamr200_node.py`)ì— ëŒ€í•œ **ì¤‘ê°„ ìˆ˜ì¤€ì˜ ìƒì„¸ ì„¤ëª…**ìž…ë‹ˆë‹¤. ì „ì²´ì ì¸ íë¦„ê³¼ ê° ì£¼ìš” êµ¬ì„± ìš”ì†Œì˜ ì—­í• ì„ ì´í•´í•  ìˆ˜ ìžˆë„ë¡ ì£¼ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ë©°, ì½”ë“œì˜ ì„¸ë¶€ êµ¬í˜„ì€ ê°„ë‹¨ížˆ ìš”ì•½í•©ë‹ˆë‹¤.

---

## ðŸ§  ì „ì²´ êµ¬ì¡° ìš”ì•½

ì´ ë…¸ë“œëŠ” `Jdamr200`ì´ë¼ëŠ” í´ëž˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ **ì‹œë¦¬ì–¼ í†µì‹ ìœ¼ë¡œ ë¡œë´‡ì„ ì œì–´**í•©ë‹ˆë‹¤. ë™ì‹œì— ROS2ì—ì„œ **ë‹¤ì–‘í•œ í¼ë¸”ë¦¬ì…”ì™€ ì„œë¸ŒìŠ¤í¬ë¼ì´ë²„**ë¥¼ ì„¤ì •í•˜ì—¬ ëª¨í„° ì œì–´, ì˜¤ë„ë©”íŠ¸ë¦¬ í¼ë¸”ë¦¬ì‹±, ë°°í„°ë¦¬ ì „ì•• í™•ì¸ ë“±ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## ðŸ“„ ì£¼ìš” ì½”ë“œ ì„¤ëª…

### 1. í´ëž˜ìŠ¤ ì •ì˜ ë° ì´ˆê¸°í™”

```python
class JdamrControlNode(Node):
    def __init__(self):
        super().__init__('jdamr_control_node')
```

* ROS2 ë…¸ë“œë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ë…¸ë“œ ì´ë¦„ì€ `'jdamr_control_node'`ìž…ë‹ˆë‹¤.

```python
self.robot = Jdamr200("/dev/ttyACM0")
```

* `Jdamr200` ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. `/dev/ttyACM0`ëŠ” ì•„ë‘ì´ë…¸ë‚˜ ESP32ê°€ ì—°ê²°ëœ **ì‹œë¦¬ì–¼ í¬íŠ¸**ìž…ë‹ˆë‹¤.
* ì‹¤ì œ ëª¨í„° ì œì–´ ë° ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ ì€ ì´ í´ëž˜ìŠ¤ì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

---

### 2. í¼ë¸”ë¦¬ì…” ë° ì„œë¸ŒìŠ¤í¬ë¼ì´ë²„ ìƒì„±

```python
self.publisher_ = self.create_publisher(String, 'jdamr_control', 10)
```

* í…ŒìŠ¤íŠ¸ìš© ë¬¸ìžì—´ í¼ë¸”ë¦¬ì…” (`jdamr_control` í† í”½, ì‚¬ìš©ë˜ì§€ ì•ŠìŒ)

```python
self.pub_odom = self.create_publisher(Odometry, 'odom', 50)
```

* `nav_msgs/Odometry` ë©”ì‹œì§€ë¥¼ `odom` í† í”½ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹œí•©ë‹ˆë‹¤.
* ìœ„ì¹˜ ë° ë°©í–¥ ë°ì´í„°ë¥¼ SLAM, Navigation ë“±ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìžˆë„ë¡ ì „ë‹¬í•©ë‹ˆë‹¤.

```python
self.pub_v = self.create_publisher(Int8, 'Voltage', 1000)
```

* ë°°í„°ë¦¬ ì „ì••(ì „ë¥˜)ì„ í‘œí˜„í•˜ê¸° ìœ„í•œ í¼ë¸”ë¦¬ì…”ìž…ë‹ˆë‹¤. í˜„ìž¬ëŠ” ê°’ `100`ë§Œ í¼ë¸”ë¦¬ì‹œí•©ë‹ˆë‹¤.

```python
self.subscriber_cmd_vel = self.create_subscription(
    Twist,
    '/cmd_vel',
    self.cmd_vel_callback,
    10
)
```

* `Twist` ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ë¡œë´‡ì„ ì œì–´í•©ë‹ˆë‹¤. í‚¤ë³´ë“œ ë˜ëŠ” ìžìœ¨ì£¼í–‰ ë…¸ë“œì—ì„œ ë°œí–‰ë©ë‹ˆë‹¤.

---

### 3. íƒ€ì´ë¨¸ ë“±ë¡

```python
self.odom_timer = self.create_timer(0.05, self.odom_timer_callback)
```

* 0.05ì´ˆë§ˆë‹¤ ì˜¤ë„ë©”íŠ¸ë¦¬ ì •ë³´ë¥¼ ê°±ì‹ í•˜ê³  ë°œí–‰í•©ë‹ˆë‹¤.

```python
self.volt_timer = self.create_timer(1, self.volt_timer_callback)
```

* 1ì´ˆë§ˆë‹¤ ì „ì•• ë°ì´í„°ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.

---

### 4. ì˜¤ë„ë©”íŠ¸ë¦¬ ì½œë°±

```python
def odom_timer_callback(self):
    msg = Odometry()
    msg.header.frame_id = 'odom'
```

* ì˜¤ë„ë©”íŠ¸ë¦¬ ë©”ì‹œì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```python
self.robot.readSpeed()
result = self.robot.update_odometry()
```

* `readSpeed()`: í˜„ìž¬ ì—”ì½”ë” ì†ë„ê°’ì„ ì½ìŠµë‹ˆë‹¤.
* `update_odometry()`: ì†ë„ì™€ ì‹œê°„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ x, y, Î¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

```python
msg.pose.pose.position.x = result[0]
msg.pose.pose.position.y = result[1]
msg.pose.pose.position.z = result[2]
self.pub_odom.publish(msg)
```

* ìœ„ì¹˜ ê°’ì„ ë©”ì‹œì§€ì— ì €ìž¥í•˜ê³  í¼ë¸”ë¦¬ì‹œí•©ë‹ˆë‹¤.

---

### 5. ì „ì•• ì½œë°±

```python
def volt_timer_callback(self):
    msg = Int8()
    msg.data = 100
    self.pub_v.publish(msg)
```

* í˜„ìž¬ëŠ” ì „ì•• ê°’ì„ `100`ìœ¼ë¡œ ê³ ì •í•´ì„œ ë³´ë‚´ì§€ë§Œ, ì‹¤ì œ ë¡œë´‡ì—ì„œëŠ” ë°°í„°ë¦¬ ì„¼ì„œë¥¼ ì—°ê²°í•´ ê°’ì„ ê°±ì‹ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

### 6. `/cmd_vel` ì½œë°±

```python
def cmd_vel_callback(self, msg):
    go_back = msg.linear.x
    rotate = msg.linear.y
    speed = int(msg.linear.z)
```

* ROS2ì˜ `geometry_msgs/Twist` ë©”ì‹œì§€ì—ì„œ ì´ë™ ë°©í–¥ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.

  * `linear.x`: ì „ì§„/í›„ì§„
  * `linear.y`: ì¢Œ/ìš° íšŒì „
  * `linear.z`: ì†ë„

```python
if go_back > 0:
    self.robot.move_run_mode(self.robot.GO_FORWARD, speed)
elif go_back < 0:
    self.robot.move_run_mode(self.robot.GO_BACKWARD, speed)
elif rotate > 0:
    self.robot.move_run_mode(self.robot.TURN_LEFT, speed)
elif rotate < 0:
    self.robot.move_run_mode(self.robot.TURN_RIGHT, speed)
else:
    self.robot.move_run_mode(self.robot.STOP, 0)
```

* ë°©í–¥ê³¼ ì†ë„ì— ë”°ë¼ ëª¨í„° ì œì–´ ëª…ë ¹ì„ ë³´ë“œì— ì „ë‹¬í•©ë‹ˆë‹¤.

---

### 7. ë©”ì¸ ë£¨í”„ ì‹¤í–‰

```python
def main_loop(self):
    while rclpy.ok():
        rclpy.spin_once(self)
```

* ë©”ì¸ ë£¨í”„ì—ì„œ íƒ€ì´ë¨¸ì™€ ì½œë°± í•¨ìˆ˜ë“¤ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

---

## âœ… ì‹¤í–‰ ì „ í™•ì¸ ìš”ì•½

1. ì—°ê²°ëœ ì‹œë¦¬ì–¼ í¬íŠ¸ í™•ì¸:

```bash
ls /dev/tty*
```

2. í¬íŠ¸ ê¶Œí•œ ë¶€ì—¬:

```bash
sudo chmod 666 /dev/ttyACM0
```

ë˜ëŠ”:

```bash
sudo usermod -a -G dialout $USER
# â†’ ë¡œê·¸ì•„ì›ƒ í›„ ìž¬ë¡œê·¸ì¸ í•„ìš”
```

3. ë…¸ë“œ ì‹¤í–‰:

```bash
ros2 run jdamr200_node jdamr200_node
```

---

í•„ìš”í•˜ë‹¤ë©´ ì´ ë‚´ìš©ì„ `README.md` ë˜ëŠ” ê°œë°œìž ë¬¸ì„œìš© `.md` íŒŒì¼ë¡œë„ ì •ë¦¬í•´ë“œë¦´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì •ë¦¬í•´ì„œ ë„£ì–´ë“œë¦´ê¹Œìš”?


