# jdamr200 Teleop ë…¸ë“œ ì‚¬ìš©ë°©ë²•, ì†ŒìŠ¤ì½”ë“œ ì„¤ëª… 
## ðŸŽ® `teleop_node.py` ê°œìš”

ì´ ì½”ë“œëŠ” í‚¤ë³´ë“œ ìž…ë ¥ìœ¼ë¡œ ROS2 ë¡œë´‡ì„ ì›ê²© ì œì–´í•˜ëŠ” **í„°ë¯¸ë„ ê¸°ë°˜ í…”ë ˆì˜µ ë…¸ë“œ**ìž…ë‹ˆë‹¤.
ROS2ì—ì„œ ì œê³µí•˜ëŠ” `teleop_twist_keyboard` ê¸°ëŠ¥ì„ ê¸°ë°˜ìœ¼ë¡œ ì»¤ìŠ¤í…€ ìˆ˜ì •í•œ ê²ƒìœ¼ë¡œ, ë‹¤ìŒ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:

### âœ… ì£¼ìš” ê¸°ëŠ¥

* `w`, `s`, `a`, `d` í‚¤ë¡œ **ë¡œë´‡ ì „ì§„/í›„ì§„/ì¢ŒíšŒì „/ìš°íšŒì „ ì œì–´**
* `u`, `j` í‚¤ë¡œ **ì†ë„ ì¡°ì ˆ (50\~100)**
* `space` ë˜ëŠ” `x` í‚¤ë¡œ **ì •ì§€**
* `CTRL+C`ë¡œ ì¢…ë£Œ ì‹œ, ë¡œë´‡ ì •ì§€ í›„ ì•ˆì „ ì¢…ë£Œ
* `Twist` ë©”ì‹œì§€ë¥¼ `/cmd_vel` í† í”½ìœ¼ë¡œ ë°œí–‰

---

## ðŸ ì‹¤í–‰ ë°©ë²•

ROS2 í™˜ê²½ì„ í™œì„±í™”í•œ í›„ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤:

```bash
source ~/jdamr200_ws/install/setup.bash
ros2 run jdamr200_teleop teleop_node
```

ì‹¤í–‰ ì‹œ ì•„ëž˜ì™€ ê°™ì€ ì¡°ìž‘ ì•ˆë‚´ê°€ í„°ë¯¸ë„ì— ì¶œë ¥ë©ë‹ˆë‹¤:

```
Control myagv!
---------------------------
Moving around:
        w     
   a    s    d
    
space key, k : stop
...
```

---

## ðŸ“¨ `cmd_vel` ë©”ì‹œì§€ ë°œí–‰ êµ¬ì¡°

* ì´ ë…¸ë“œëŠ” `geometry_msgs/msg/Twist` ë©”ì‹œì§€ë¥¼ **`/cmd_vel`** í† í”½ìœ¼ë¡œ í¼ë¸”ë¦¬ì‹œí•©ë‹ˆë‹¤.
* ì´ ë©”ì‹œì§€ëŠ” **ë¡œë´‡ì˜ ì´ë™ ëª…ë ¹**ì„ í¬í•¨í•˜ê³  ìžˆìœ¼ë©°, ë‹¤ìŒ í•„ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```plaintext
twist.linear.x  â†’ ì „ì§„/í›„ì§„
twist.linear.y  â†’ ì¢ŒíšŒì „/ìš°íšŒì „
twist.linear.z  â†’ ì†ë„ê°’ (ì»¤ìŠ¤í…€ ì‚¬ìš©)
```

---

## âš™ï¸ ì½”ë“œ êµ¬ì¡° ì„¤ëª…

### 1. ë…¸ë“œ ì´ˆê¸°í™”

```python
self.pub = self.create_publisher(Twist, '/cmd_vel', 10)
```

* `/cmd_vel` í† í”½ì— ë©”ì‹œì§€ë¥¼ ë°œí–‰í•  í¼ë¸”ë¦¬ì…”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### 2. í‚¤ ìž…ë ¥ ì²˜ë¦¬ ë° ì œì–´ê°’ ì„¤ì •

```python
key = self.get_key()
```

* `get_key()` í•¨ìˆ˜ëŠ” ì‚¬ìš©ìžì˜ í‚¤ë³´ë“œ ìž…ë ¥ì„ ì½ìŠµë‹ˆë‹¤. non-blocking ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

```python
if key == 'w':
    self.x = 0.5  # ì „ì§„
elif key == 's':
    self.x = -0.5 # í›„ì§„
elif key == 'a':
    self.y = 0.5  # ì¢ŒíšŒì „
elif key == 'd':
    self.y = -0.5 # ìš°íšŒì „
...
elif key == 'u':
    self.speed += 10.0  # ì†ë„ ì¦ê°€
```

* `x`, `y` ë°©í–¥ì„ ì¡°ì •í•˜ê³  `speed`ëŠ” `linear.z`ì— ì„¤ì •ë˜ì–´ ë¡œë´‡ ëª¨í„° ì†ë„ ì œì–´ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

### 3. Twist ë©”ì‹œì§€ ìƒì„± ë° í¼ë¸”ë¦¬ì‹œ

```python
twist = Twist()
twist.linear.x = self.x
twist.linear.y = self.y
twist.linear.z = self.speed
...
self.pub.publish(twist)
```

* `Twist` ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì—¬ í˜„ìž¬ ë°©í–¥, ì†ë„ ì •ë³´ë¥¼ í¬í•¨í•´ `/cmd_vel`ë¡œ ë°œí–‰í•©ë‹ˆë‹¤.

---

## ðŸ¤– `jdamr200_node`ì—ì„œ cmd\_vel ì²˜ë¦¬ ë°©ì‹

`jdamr200_node`ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ `/cmd_vel`ì„ êµ¬ë…í•©ë‹ˆë‹¤:

```python
self.subscriber_cmd_vel = self.create_subscription(
    Twist,
    '/cmd_vel',
    self.cmd_vel_callback,
    10
)
```

* ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ë©´ `cmd_vel_callback()`ì´ í˜¸ì¶œë©ë‹ˆë‹¤.
* ì´ ì½œë°± í•¨ìˆ˜ëŠ” ìˆ˜ì‹ ëœ ë°©í–¥ê³¼ ì†ë„ ì •ë³´ë¥¼ ë¶„ì„í•´ `Jdamr200` í´ëž˜ìŠ¤ì˜ `move_run_mode()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

  * ì˜ˆ: ì „ì§„ â†’ `GO_FORWARD`, íšŒì „ â†’ `TURN_LEFT` ë“±
* ì´í›„ í•´ë‹¹ ëª…ë ¹ì€ ì‹œë¦¬ì–¼ í†µì‹ ìœ¼ë¡œ ìž„ë² ë””ë“œ ë³´ë“œì— ì „ì†¡ë˜ì–´ ëª¨í„°ê°€ ë™ìž‘í•©ë‹ˆë‹¤.

---

## ðŸ”„ ë©”ì‹œì§€ íë¦„ ìš”ì•½

```plaintext
[teleop_node]  --- Twist(msg) -->  /cmd_vel  -->  [jdamr200_node]  --> serial --> Robot control
```

* í‚¤ë³´ë“œ â†’ ROS2 í† í”½ `/cmd_vel` â†’ ëª¨í„° ëª…ë ¹ ë³€í™˜ â†’ ë¡œë´‡ ì œì–´

---

